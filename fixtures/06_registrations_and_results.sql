-- Registrations, results, tournament tags, and points recalculation

-- Register ALL players in ALL tournaments (12 players × 21 tournaments = 252 registrations)
INSERT INTO tournament_registrations (tournament_id, user_id, status)
SELECT t.id, u.id, 'registered'
FROM tournaments t
CROSS JOIN (
    SELECT id FROM users
    WHERE role = 'player'
) u;

-- Tournament results for finished tournaments (9 total: 3 per club)
INSERT INTO tournament_results (tournament_id, user_id, final_position, prize_cents) VALUES
-- Poker One Tournaments
('10001111-1111-1111-1111-111111111111', '70707070-7070-7070-7070-707070707070', 1, 75000),
('10001111-1111-1111-1111-111111111111', '40404040-4040-4040-4040-404040404040', 2, 45000),
('10001111-1111-1111-1111-111111111111', '50505050-5050-5050-5050-505050505050', 3, 30000),

('10002222-2222-2222-2222-222222222222', '70707070-7070-7070-7070-707070707070', 1, 90000),
('10002222-2222-2222-2222-222222222222', '30303030-3030-3030-3030-303030303030', 2, 54000),
('10002222-2222-2222-2222-222222222222', '80808080-8080-8080-8080-808080808080', 3, 36000),

('10003333-3333-3333-3333-333333333333', '70707070-7070-7070-7070-707070707070', 1, 120000),
('10003333-3333-3333-3333-333333333333', '60606060-6060-6060-6060-606060606060', 2, 72000),
('10003333-3333-3333-3333-333333333333', 'c0c0c0c0-c0c0-c0c0-c0c0-c0c0c0c0c0c0', 3, 48000),

-- Liège Poker Club Tournaments
('20011111-1111-1111-1111-111111111111', '70707070-7070-7070-7070-707070707070', 1, 90000),
('20011111-1111-1111-1111-111111111111', '30303030-3030-3030-3030-303030303030', 2, 54000),
('20011111-1111-1111-1111-111111111111', '40404040-4040-4040-4040-404040404040', 3, 36000),

('20012222-2222-2222-2222-222222222222', '70707070-7070-7070-7070-707070707070', 1, 120000),
('20012222-2222-2222-2222-222222222222', '50505050-5050-5050-5050-505050505050', 2, 72000),
('20012222-2222-2222-2222-222222222222', '60606060-6060-6060-6060-606060606060', 3, 48000),

('20013333-3333-3333-3333-333333333333', '70707070-7070-7070-7070-707070707070', 1, 75000),
('20013333-3333-3333-3333-333333333333', '80808080-8080-8080-8080-808080808080', 2, 45000),
('20013333-3333-3333-3333-333333333333', '90909090-9090-9090-9090-909090909090', 3, 30000),

-- Pokah Room Antwerp Tournaments
('30021111-1111-1111-1111-111111111111', '70707070-7070-7070-7070-707070707070', 1, 105000),
('30021111-1111-1111-1111-111111111111', 'b0b0b0b0-b0b0-b0b0-b0b0-b0b0b0b0b0b0', 2, 63000),
('30021111-1111-1111-1111-111111111111', 'c0c0c0c0-c0c0-c0c0-c0c0-c0c0c0c0c0c0', 3, 42000),

('30022222-2222-2222-2222-222222222222', '30303030-3030-3030-3030-303030303030', 1, 135000),
('30022222-2222-2222-2222-222222222222', '70707070-7070-7070-7070-707070707070', 2, 81000),
('30022222-2222-2222-2222-222222222222', 'e0e0e0e0-e0e0-e0e0-e0e0-e0e0e0e0e0e0', 3, 54000),

('30023333-3333-3333-3333-333333333333', '70707070-7070-7070-7070-707070707070', 1, 90000),
('30023333-3333-3333-3333-333333333333', 'd0d0d0d0-d0d0-d0d0-d0d0-d0d0d0d0d0d0', 2, 54000),
('30023333-3333-3333-3333-333333333333', '40404040-4040-4040-4040-404040404040', 3, 36000);

-- Link tournaments to tags randomly
WITH tournament_tag_pairs AS (
    SELECT t.id as tournament_id, tag.id as tag_id, ROW_NUMBER() OVER (ORDER BY t.id) as rn
    FROM tournaments t
    CROSS JOIN tags tag
    WHERE MOD(ABS(HASHTEXT(t.id::text)), 4) = MOD(ABS(HASHTEXT(tag.id::text)), 4)
)
INSERT INTO tournament_tags (tournament_id, tag_id)
SELECT tournament_id, tag_id FROM tournament_tag_pairs LIMIT 50;

-- Calculate points for all tournaments with results
SELECT recalculate_all_tournament_points();
