# ============================================
# PocketPair Backend (pp-service) Environment Configuration
# ============================================
# Copy this file to .env and configure for your environment

# ============================================
# Database Configuration
# ============================================

# PostgreSQL connection string
# Format: postgres://user:password@host:port/database
# For local development with Docker Compose: use localhost:15432
# For Docker container: use postgres:5432 (service name)
DATABASE_URL=postgres://postgres:admin@localhost:15432/pocketpair

# Connection pool settings
# Maximum number of concurrent database connections (default: 30)
DATABASE_MAX_CONNECTIONS=30

# Test database (used by cargo test)
# Should be a separate database to avoid conflicts with development data
TEST_DATABASE_URL=postgres://postgres:admin@localhost:15432/pocketpair_test

# ============================================
# Docker Environment Variables (for docker-compose)
# ============================================

# Environment type (dev, staging, production)
DOCKER_ENV=dev

# PostgreSQL database name (used by docker-compose)
PG_DB=pocketpair

# PostgreSQL user (used by docker-compose)
PG_USER=postgres

# PostgreSQL password (used by docker-compose)
# IMPORTANT: Change this in production
PG_PASSWORD=admin

# ============================================
# Server Configuration
# ============================================

# Port the API server listens on (default: 8080)
PORT=8080

# Logging level: trace, debug, info, warn, error
# Use 'debug' for development, 'info' or 'warn' for production
RUST_LOG=info

# Skip database migrations on startup (default: false)
# Set to true if you want to run migrations manually
# Migrations are in ./migrations/ and run via SQLx
SKIP_MIGRATIONS=false

# ============================================
# JWT Authentication (REQUIRED)
# ============================================

# Secret key for signing JWT tokens
# CRITICAL: Generate a secure random string for production
# Example: openssl rand -base64 32
# DO NOT use the default value in production
JWT_SECRET=your-secure-jwt-secret-key-change-this-in-production

# JWT token expiration time in hours (default: 24)
JWT_EXPIRATION_HOURS=24

# ============================================
# OAuth Configuration (Optional)
# ============================================

# Google OAuth 2.0 credentials
# Get these from: https://console.cloud.google.com/apis/credentials
# Required only if you want to enable Google OAuth login
GOOGLE_CLIENT_ID=your-google-client-id
GOOGLE_CLIENT_SECRET=your-google-client-secret

# OAuth redirect base URL
# For local development: http://localhost:8080
# For production: https://your-domain.com
# Used to construct OAuth callback URLs
REDIRECT_BASE_URL=http://localhost:8080

# ============================================
# SQLx Configuration (Build-time)
# ============================================

# SQLx offline mode for building without a database connection
# Set to 'true' to use pre-generated .sqlx/ metadata for compile-time verification
# Required when building in CI/CD or Docker without database access
# After schema changes, run: cargo sqlx prepare --workspace -- --tests
SQLX_OFFLINE=true

# ============================================
# Email Service (Scaleway Transactional Email) - Optional
# ============================================
# If not configured, the app runs without email sending (graceful degradation)

# Scaleway API secret key (required for email)
# Get from: https://console.scaleway.com/iam/api-keys
SCW_SECRET_KEY=your-scaleway-secret-key

# Scaleway project ID (required for email)
SCW_DEFAULT_PROJECT_ID=your-scaleway-project-id

# Scaleway region for transactional email (default: fr-par)
SCW_REGION=fr-par

# Sender email address (must be verified in Scaleway)
SCW_SENDER_EMAIL=noreply@yourdomain.com

# Sender display name (default: PocketPair)
SCW_SENDER_NAME=PocketPair

# Frontend base URL for links in emails (e.g. password reset)
# Should point to the tournament manager frontend
FRONTEND_BASE_URL=http://localhost:3000

# ============================================
# GraphQL Configuration
# ============================================

# Enable GraphQL introspection (schema discovery)
# Set to 'true' for development (allows GraphQL clients to discover schema)
# Set to 'false' for production (prevents schema disclosure to unauthorized clients)
GQL_INTROSPECTION=true

# Maximum query depth allowed
# Prevents deeply nested queries from consuming excessive server resources
# Introspection queries are inherently deep; increase this if needed for schema loading
# Default: 15, Introspection typically requires: ~20+
GQL_QUERY_DEPTH_LIMIT=30

# Maximum query complexity allowed
# Prevents expensive queries from overwhelming the server
# Complexity is calculated based on field count and multipliers for lists
# Introspection queries are inherently complex; increase this if needed for schema loading
# Default: 200, Introspection typically requires: ~1000+
GQL_QUERY_COMPLEXITY_LIMIT=2000